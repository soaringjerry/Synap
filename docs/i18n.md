# 国际化（i18n）设计（MVP）

## 目标

- 英文 + 中文双语支持（UI + 问卷题干 + 同意书）。
- 语言选择策略：URL `?lang=xx` > `Accept-Language` > 默认 `en`。
- 回退策略：没有对应语言时回退英文。

## 后端

- Locale 解析：`internal/utils/acceptlang.go` + `internal/middleware/locale.go`。
- 服务端仅提供必要提示的翻译（如健康检查），业务文案主要由前端负责。
- API 响应可根据 `locale`（存于 context）返回对应语言内容。

## 数据库（SQLite）

为避免列膨胀，采用翻译表：

- `scales(id, points, randomize, version)`
- `scale_i18n(scale_id, locale, name)`
- `items(id, scale_id, reverse_scored)`
- `item_i18n(item_id, locale, stem)`

示例：

```
-- 查某个量表的题目（包含翻译，若无则英文）
SELECT it.id, COALESCE(t.stem, t_en.stem) AS stem
FROM items it
LEFT JOIN item_i18n t ON t.item_id = it.id AND t.locale = :locale
LEFT JOIN item_i18n t_en ON t_en.item_id = it.id AND t_en.locale = 'en'
WHERE it.scale_id = :scale_id
ORDER BY it.id;
```

## 前端（React + i18next）

- 语言包：`frontend/src/i18n/locales/en.json`、`zh.json`。
- 初始化：`frontend/src/i18n/index.ts`（命名空间可按页面拆分）。
- 语言选择：
  - URL 参数 `?lang=xx` 并存储到 `localStorage`；
  - 初次从浏览器 `navigator.language` 兜底；
  - 与后端 `Accept-Language` 一致策略。

## MVP 范围

- 健康检查返回当前 `locale` 与一条本地化消息。
- 题干/量表名称从翻译表加载（后续实现 DB 接入时启用）。

